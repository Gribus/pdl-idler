@echo off
setlocal EnableDelayedExpansion
c:
cd "C:\Program Files (x86)\Steam\steamapps\SteamAchievementManager63_hotfix"
set y=0

REM | (re)create array
:BEGIN
echo Randomizing Games
set n=0
for %%a in (343730 343740 348250 379670 381940 396060 405480 407060 410390 420020 420840 427760 431390 434430 436340 436740 436820 439260 446750 447100 447270 448980 449130 450390 452490 453170 456570 457230 457420 457580 457660 458590 460510 460850 461320 464540 465310 466260 469650 469990 470130 471630 475050 477130 478000 482390 483680 483970 484870 485780 485880 490840 491790 491800 494380 494830 495030 495300 497820 498510 498600 499760 500500 501180 501380 503160 506280 509360 510130 510910 512080 512270 512630 512710 513050 513420 515020 516470 517400 517550 518580 519030 519170 519940 520010 521860 524030 524120 525540 525910 526180 528550 528990 529540 534460 534480 536210 536530 537060 537590 538330 542820 544130 544410 544590 547440 547850 550160 550520 550820 552630 555160 555170 559010 561080 563760 564520 566150 566580 568800 569640 573550 574190 575110 575600 577780 579040 580630 583510 589240 591660 593090 595070 600140 600650 602010 602140 603630 604530 605860 606180 607860 608980 611120 612790 615460 615650 617600 619020 622310 624920 635190 637960 654070 657010 672160 681550 708370 712060 714580 728110 730090 744660 770990 269170 327140) do (
  set games[!n!]=%%a
  set /A n+=1
)
set total=%n%
set n=0

REM | wait until steam is running
:CHECK
tasklist /FI "IMAGENAME eq Steam.exe" 2>NUL | find /I /N "Steam.exe">NUL
if "%ERRORLEVEL%"=="1" (
  echo steamNotRunning
  timeout /t 10
  goto :CHECK
)

REM | start three instances of SAM
:GAME
if %n% equ %total% goto :BEGIN
call :getRandomElem i=
echo started appid !games[%i%]!
start /min SAM.Game1.exe !games[%i%]!
set games[!i!]=0
set /A n+=1
set /A y+=1
if %y% lss 3 goto :GAME

REM | wait ten seconds, kill tasks, then wait till next minute
set y=0
timeout /t 10
taskkill /IM SAM.Game1.exe
set /a tosleep=60-%TIME:~6,2%
timeout /t %tosleep%
goto :CHECK

REM | function to get random element
:getRandomElem i=
set /A i = total * %random% / 32768
if !games[%i%]! equ 0 goto getRandomElem
exit /B
